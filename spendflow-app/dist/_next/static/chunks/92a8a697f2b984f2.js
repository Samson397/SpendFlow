(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75254,e=>{"use strict";var t=e.i(82078);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:o="",children:c,iconNode:d,...l},u)=>(0,t.createElement)("svg",{ref:u,...i,width:r,height:r,stroke:e,strokeWidth:s?24*Number(n)/Number(r):n,className:a("lucide",o),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(l)&&{"aria-hidden":"true"},...l},[...d.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(c)?c:[c]])),s=(e,i)=>{let s=(0,t.forwardRef)(({className:s,...o},c)=>(0,t.createElement)(n,{ref:c,iconNode:i,className:a(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,s),...o}));return s.displayName=r(e),s};e.s(["default",()=>s],75254)},64637,60333,e=>{"use strict";var t=e.i(73291);(0,t.registerVersion)("firebase","12.4.0","app"),e.s([],64637);var r=e.i(92560);e.s(["FirebaseError",()=>r.FirebaseError,"SDK_VERSION",()=>t.SDK_VERSION,"_DEFAULT_ENTRY_NAME",()=>t._DEFAULT_ENTRY_NAME,"_addComponent",()=>t._addComponent,"_addOrOverwriteComponent",()=>t._addOrOverwriteComponent,"_apps",()=>t._apps,"_clearComponents",()=>t._clearComponents,"_components",()=>t._components,"_getProvider",()=>t._getProvider,"_isFirebaseApp",()=>t._isFirebaseApp,"_isFirebaseServerApp",()=>t._isFirebaseServerApp,"_isFirebaseServerAppSettings",()=>t._isFirebaseServerAppSettings,"_registerComponent",()=>t._registerComponent,"_removeServiceInstance",()=>t._removeServiceInstance,"_serverApps",()=>t._serverApps,"deleteApp",()=>t.deleteApp,"getApp",()=>t.getApp,"getApps",()=>t.getApps,"initializeApp",()=>t.initializeApp,"initializeServerApp",()=>t.initializeServerApp,"onLog",()=>t.onLog,"registerVersion",()=>t.registerVersion,"setLogLevel",()=>t.setLogLevel],60333)},2188,e=>{"use strict";var t=e.i(52621),r=e.i(82078);e.i(32234);var a=e.i(98466),i=e.i(41195);let n=(0,r.createContext)({user:null,loading:!0,isAdmin:!1});e.s(["AuthProvider",0,({children:e})=>{let[s,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0),[l,u]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=(0,a.onAuthStateChanged)(i.auth,async e=>{o(e),d(!1),e?.email?u(("spendflowapp@gmail.com".split(",")||[]).includes(e.email)):u(!1)});return()=>e()},[]),(0,t.jsx)(n.Provider,{value:{user:s,loading:c,isAdmin:l},children:e})},"useAuth",0,()=>(0,r.useContext)(n)])},30945,e=>{"use strict";var t=e.i(41195);e.i(75271);var r=e.i(5158);let a=e=>e?e instanceof r.Timestamp?e.toDate():Array.isArray(e)?e.map(a):"object"==typeof e&&null!==e?Object.entries(e).reduce((e,[t,r])=>({...e,[t]:a(r)}),{}):e:e;class i{collectionName;constructor(e){this.collectionName=e}toObject(e){return e.exists()?{id:e.id,...a(e.data())}:null}toFirestore(e){let{id:t,...r}=e;return r}async get(e){let a=(0,r.doc)(t.db,this.collectionName,e),i=await (0,r.getDoc)(a);return this.toObject(i)}async getAll(){return(await (0,r.getDocs)((0,r.collection)(t.db,this.collectionName))).docs.map(e=>this.toObject(e))}async getByUserId(e){let a=(0,r.query)((0,r.collection)(t.db,this.collectionName),(0,r.where)("userId","==",e));return(await (0,r.getDocs)(a)).docs.map(e=>this.toObject(e))}async create(e){let a=new Date,i=await (0,r.addDoc)((0,r.collection)(t.db,this.collectionName),{...e,createdAt:a,updatedAt:a});return{...e,id:i.id,createdAt:a,updatedAt:a}}async update(e,a){if(!await this.get(e))throw Error(`Document with ID ${e} does not exist in collection ${this.collectionName}`);let i=(0,r.doc)(t.db,this.collectionName,e);await (0,r.updateDoc)(i,{...a,updatedAt:new Date})}async delete(e){let a=(0,r.doc)(t.db,this.collectionName,e);await (0,r.deleteDoc)(a)}subscribe(e,...a){let i=(0,r.query)((0,r.collection)(t.db,this.collectionName),...a);return(0,r.onSnapshot)(i,t=>{e(t.docs.map(e=>this.toObject(e)).filter(e=>null!==e))})}subscribeToDoc(e,a){let i=(0,r.doc)(t.db,this.collectionName,e);return(0,r.onSnapshot)(i,e=>{a(this.toObject(e))})}}let n=new i("users"),s=new i("cards"),o=new i("transactions"),c={get:e=>o.get(e),getAll:()=>o.getAll(),create:e=>o.create(e),update:(e,t)=>o.update(e,t),delete:e=>o.delete(e),async getByUserId(e){let a=(0,r.query)((0,r.collection)(t.db,"transactions"),(0,r.where)("userId","==",e),(0,r.orderBy)("date","desc"));return(await (0,r.getDocs)(a)).docs.map(e=>({id:e.id,...e.data(),date:e.data().date?.toDate(),createdAt:e.data().createdAt?.toDate(),updatedAt:e.data().updatedAt?.toDate()}))},async getRecentByUserId(e,a=10){let i=(0,r.query)((0,r.collection)(t.db,"transactions"),(0,r.where)("userId","==",e),(0,r.orderBy)("date","desc"),(0,r.limit)(a));return(await (0,r.getDocs)(i)).docs.map(e=>({id:e.id,...e.data(),date:e.data().date?.toDate(),createdAt:e.data().createdAt?.toDate(),updatedAt:e.data().updatedAt?.toDate()}))},async getByDateRange(e,a,i){let n=(0,r.query)((0,r.collection)(t.db,"transactions"),(0,r.where)("userId","==",e),(0,r.where)("date",">=",a),(0,r.where)("date","<=",i),(0,r.orderBy)("date","desc"));return(await (0,r.getDocs)(n)).docs.map(e=>({id:e.id,...e.data(),date:e.data().date?.toDate(),createdAt:e.data().createdAt?.toDate(),updatedAt:e.data().updatedAt?.toDate()}))},async getTotalByType(e,t,r,a){return(await this.getByDateRange(e,r,a)).filter(e=>e.type===t).reduce((e,t)=>e+t.amount,0)}},d=new i("expenses"),l=new i("income"),u={...new i("categories"),async getByType(e){let a=(0,r.query)((0,r.collection)(t.db,"categories"),(0,r.where)("type","==",e));return(await (0,r.getDocs)(a)).docs.map(e=>({id:e.id,...e.data()}))},async getAll(){let e=(0,r.query)((0,r.collection)(t.db,"categories"));return(await (0,r.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}))},async initDefaultCategories(){let e=await this.getAll(),a=[];for(let t of[{name:"Housing",color:"#3B82F6",icon:"ðŸ ",type:"expense"},{name:"Food",color:"#10B981",icon:"ðŸ”",type:"expense"},{name:"Transportation",color:"#F59E0B",icon:"ðŸš—",type:"expense"},{name:"Utilities",color:"#8B5CF6",icon:"ðŸ’¡",type:"expense"},{name:"Entertainment",color:"#EC4899",icon:"ðŸŽ®",type:"expense"},{name:"Shopping",color:"#F43F5E",icon:"ðŸ›ï¸",type:"expense"},{name:"Healthcare",color:"#06B6D4",icon:"ðŸ¥",type:"expense"},{name:"Education",color:"#14B8A6",icon:"ðŸ“š",type:"expense"},{name:"Travel",color:"#F97316",icon:"âœˆï¸",type:"expense"},{name:"Other",color:"#64748B",icon:"ðŸ“Œ",type:"expense"},{name:"Salary",color:"#10B981",icon:"ðŸ’°",type:"income"},{name:"Freelance",color:"#3B82F6",icon:"ðŸ’¼",type:"income"},{name:"Investment",color:"#8B5CF6",icon:"ðŸ“ˆ",type:"income"},{name:"Gift",color:"#EC4899",icon:"ðŸŽ",type:"income"},{name:"Other",color:"#64748B",icon:"ðŸ“Œ",type:"income"}])e.some(e=>e.name===t.name&&e.type===t.type)||a.push(t);if(a.length>0){let e=a.map(e=>(0,r.addDoc)((0,r.collection)(t.db,"categories"),e));await Promise.all(e)}}};e.s(["cardsService",0,{get:e=>s.get(e),getAll:()=>s.getAll(),create:e=>s.create(e),update:(e,t)=>s.update(e,t),delete:e=>s.delete(e),async getByUserId(e){let a=(0,r.query)((0,r.collection)(t.db,"cards"),(0,r.where)("userId","==",e),(0,r.orderBy)("createdAt","desc"));return(await (0,r.getDocs)(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:e.data().createdAt?.toDate(),updatedAt:e.data().updatedAt?.toDate()}))},async updateBalance(e,a){let i=(0,r.doc)(t.db,"cards",e);await (0,r.updateDoc)(i,{balance:a,updatedAt:new Date})}},"categoriesService",0,u,"expensesService",0,{get:e=>d.get(e),getAll:()=>d.getAll(),create:e=>d.create(e),update:(e,t)=>d.update(e,t),delete:e=>d.delete(e),async getActiveByUserId(e){let a=(0,r.query)((0,r.collection)(t.db,"expenses"),(0,r.where)("userId","==",e),(0,r.where)("isActive","==",!0),(0,r.orderBy)("paymentDate","asc"));return(await (0,r.getDocs)(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:e.data().createdAt?.toDate(),updatedAt:e.data().updatedAt?.toDate()}))},getByCategory:async(e,t,r)=>Object.entries((await c.getByDateRange(e,t,r)).filter(e=>"expense"===e.type).reduce((e,t)=>({...e,[t.category]:(e[t.category]||0)+t.amount}),{})).map(([e,t])=>({category:e,amount:t}))},"incomeService",0,{get:e=>l.get(e),getAll:()=>l.getAll(),create:e=>l.create(e),update:(e,t)=>l.update(e,t),delete:e=>l.delete(e),async getByUserId(e){let a=(0,r.query)((0,r.collection)(t.db,"income"),(0,r.where)("userId","==",e),(0,r.orderBy)("date","desc"));return(await (0,r.getDocs)(a)).docs.map(e=>({id:e.id,...e.data(),date:e.data().date?.toDate(),createdAt:e.data().createdAt?.toDate(),updatedAt:e.data().updatedAt?.toDate()}))},async getTotalByPeriod(e,t,r){return(await this.getByUserId(e)).filter(e=>e.date>=t&&e.date<=r).reduce((e,t)=>e+t.amount,0)}},"transactionsService",0,c,"usersService",0,{get:e=>n.get(e),getAll:()=>n.getAll(),create:e=>n.create(e),update:(e,t)=>n.update(e,t),delete:e=>n.delete(e),async getByEmail(e){let a=(0,r.query)((0,r.collection)(t.db,"users"),(0,r.where)("email","==",e),(0,r.limit)(1)),i=await (0,r.getDocs)(a);if(i.empty)return null;let n=i.docs[0];return{id:n.id,...n.data()}},async makeAdmin(e){let a=(0,r.doc)(t.db,"users",e);await (0,r.updateDoc)(a,{isAdmin:!0})},async updateTier(e,a){let i=(0,r.doc)(t.db,"users",e),n=new Date;await (0,r.updateDoc)(i,{"subscription.tier":a,"subscription.status":"active","subscription.updatedAt":n,features:{free:{maxCards:2,maxTransactions:100,analytics:!1,export:!1,prioritySupport:!1},pro:{maxCards:10,maxTransactions:1e3,analytics:!0,export:!0,prioritySupport:!1},enterprise:{maxCards:50,maxTransactions:1e4,analytics:!0,export:!0,prioritySupport:!0}}[a],updatedAt:n})}}])},69834,e=>{"use strict";e.i(75271);var t=e.i(5158),r=e.i(41195);e.i(64637);var a=e.i(60333);class i{static instance;queue=[];activeRequests=0;MAX_CONCURRENT=5;BASE_DELAY=1e3;MAX_RETRIES=3;constructor(){}static getInstance(){return i.instance||(i.instance=new i),i.instance}async processQueue(){if(this.activeRequests>=this.MAX_CONCURRENT||0===this.queue.length)return;this.activeRequests++;let e=this.queue.shift();try{await e?.()}finally{this.activeRequests--,this.processQueue()}}async withRetry(e,t=this.MAX_RETRIES){try{return await e()}catch(r){if(this.isQuotaError(r)&&t>0){let r=this.calculateBackoff(t);return console.warn(`Quota exceeded, retrying in ${r}ms... (${t} retries left)`),await new Promise(e=>setTimeout(e,r)),this.withRetry(e,t-1)}throw r}}isQuotaError(e){return e instanceof a.FirebaseError&&"resource-exhausted"===e.code}calculateBackoff(e){return Math.min(this.BASE_DELAY*Math.pow(2,this.MAX_RETRIES-e),1e4)}async enqueue(e){return new Promise((t,r)=>{let a=async()=>{try{let r=await this.withRetry(e);t(r)}catch(e){this.isQuotaError(e)&&console.error("Firestore quota exceeded. Please try again later."),r(e)}};this.queue.push(a),this.processQueue()})}clear(){this.queue=[],this.activeRequests=0}}let n=i.getInstance();class s{static instance;plansRef=(0,t.collection)(r.db,"subscriptionPlans");subscriptionsRef=(0,t.collection)(r.db,"userSubscriptions");paymentsRef=(0,t.collection)(r.db,"subscriptionPayments");changesRef=(0,t.collection)(r.db,"subscriptionChanges");notificationsRef=(0,t.collection)(r.db,"subscriptionNotifications");constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}async getPlans(){let e=[];return(await (0,t.getDocs)((0,t.query)(this.plansRef,(0,t.where)("isActive","==",!0),(0,t.orderBy)("price","asc")))).forEach(t=>{let r=t.data();e.push({id:t.id,...r,createdAt:r.createdAt?.toDate()||new Date,updatedAt:r.updatedAt?.toDate()||new Date})}),e}async getPlan(e){let r=(0,t.doc)(this.plansRef,e),a=await (0,t.getDoc)(r);if(!a.exists())return null;let i=a.data();return{id:a.id,...i,createdAt:i.createdAt?.toDate()||new Date,updatedAt:i.updatedAt?.toDate()||new Date}}async createPlan(e){return(await (0,t.addDoc)(this.plansRef,{...e,createdAt:t.Timestamp.now(),updatedAt:t.Timestamp.now()})).id}async updatePlan(e,r){let a=(0,t.doc)(this.plansRef,e);await (0,t.updateDoc)(a,{...r,updatedAt:t.Timestamp.now()})}async getUserSubscription(e){let r=(0,t.query)(this.subscriptionsRef,(0,t.where)("userId","==",e),(0,t.orderBy)("createdAt","desc"),(0,t.limit)(1)),a=await (0,t.getDocs)(r);if(a.empty)return null;let i=a.docs[0],n=i.data();return{id:i.id,...n,currentPeriodStart:n.currentPeriodStart?.toDate()||new Date,currentPeriodEnd:n.currentPeriodEnd?.toDate()||new Date,canceledAt:n.canceledAt?.toDate(),trialStart:n.trialStart?.toDate(),trialEnd:n.trialEnd?.toDate(),createdAt:n.createdAt?.toDate()||new Date,updatedAt:n.updatedAt?.toDate()||new Date}}async createSubscription(e,r){return await n.enqueue(async()=>{let a=await this.getPlan(r.planId);if(!a)throw Error("Plan not found");let i=await this.getUserSubscription(e);if(i&&"active"===i.status)throw Error("User already has an active subscription");let n=new Date,s={userId:e,planId:r.planId,status:r.trialDays?"trialing":"active",currentPeriodStart:n,currentPeriodEnd:new Date(n.getTime()+2592e6),cancelAtPeriodEnd:!1,trialStart:r.trialDays?n:void 0,trialEnd:r.trialDays?new Date(n.getTime()+24*r.trialDays*36e5):void 0,createdAt:n,updatedAt:n},o=await (0,t.addDoc)(this.subscriptionsRef,{...s,currentPeriodStart:t.Timestamp.fromDate(s.currentPeriodStart),currentPeriodEnd:t.Timestamp.fromDate(s.currentPeriodEnd),trialStart:s.trialStart?t.Timestamp.fromDate(s.trialStart):null,trialEnd:s.trialEnd?t.Timestamp.fromDate(s.trialEnd):null,createdAt:t.Timestamp.fromDate(s.createdAt),updatedAt:t.Timestamp.fromDate(s.updatedAt)});await this.createSubscriptionChange({userId:e,toPlanId:r.planId,changeType:"reactivate",effectiveDate:n,status:"completed"}),await this.updateUserProfileSubscription(e,a);let c={id:o.id,...s};return{subscription:c,plan:a,nextBillingDate:c.currentPeriodEnd,canUpgrade:"enterprise"!==a.tier,canDowngrade:"free"!==a.tier}})}async updateSubscription(e,r,a){return await n.enqueue(async()=>{let i=(0,t.doc)(this.subscriptionsRef,r),n=await (0,t.getDoc)(i);if(!n.exists())throw Error("Subscription not found");let s=n.data();if(s.userId!==e)throw Error("Unauthorized");if(a.planId&&a.planId!==s.planId){let r=await this.getPlan(a.planId);if(!r)throw Error("New plan not found");let n=await this.getPlan(s.planId);if(!n)throw Error("Current plan not found");let o=this.getTierOrder(r.tier)>this.getTierOrder(n.tier)?"upgrade":"downgrade";await this.createSubscriptionChange({userId:e,fromPlanId:s.planId,toPlanId:a.planId,changeType:o,effectiveDate:new Date,status:"completed"}),await (0,t.updateDoc)(i,{planId:a.planId,updatedAt:t.Timestamp.now()}),await this.updateUserProfileSubscription(e,r);let c=await this.getUserSubscription(e);if(!c)throw Error("Failed to retrieve updated subscription");return{subscription:c,plan:r,nextBillingDate:c.currentPeriodEnd,canUpgrade:"enterprise"!==r.tier,canDowngrade:"free"!==r.tier}}let o={updatedAt:t.Timestamp.now()};void 0!==a.cancelAtPeriodEnd&&(o.cancelAtPeriodEnd=a.cancelAtPeriodEnd,a.cancelAtPeriodEnd&&(o.canceledAt=t.Timestamp.now(),await this.createSubscriptionChange({userId:e,fromPlanId:s.planId,toPlanId:s.planId,changeType:"cancel",effectiveDate:new Date,status:"completed"}))),void 0!==a.stripeSubscriptionId&&(o.stripeSubscriptionId=a.stripeSubscriptionId),void 0!==a.status&&(o.status=a.status),void 0!==a.currentPeriodEnd&&(o.currentPeriodEnd=t.Timestamp.fromDate(a.currentPeriodEnd)),await (0,t.updateDoc)(i,o);let c=await this.getPlan(s.planId);if(!c)throw Error("Plan not found");let d=await this.getUserSubscription(e);if(!d)throw Error("Failed to retrieve updated subscription");return{subscription:d,plan:c,nextBillingDate:d.currentPeriodEnd,canUpgrade:"enterprise"!==c.tier,canDowngrade:"free"!==c.tier}})}async cancelSubscription(e,t){await this.updateSubscription(e,t,{cancelAtPeriodEnd:!0})}async reactivateSubscription(e,r){return await n.enqueue(async()=>{let a=(0,t.doc)(this.subscriptionsRef,r),i=await (0,t.getDoc)(a);if(!i.exists())throw Error("Subscription not found");let n=i.data();if(n.userId!==e)throw Error("Unauthorized");let s={cancelAtPeriodEnd:!1,status:"active",updatedAt:t.Timestamp.now()},o={};Object.keys(s).forEach(e=>{void 0!==s[e]&&(o[e]=s[e])}),await (0,t.updateDoc)(a,o);let c=await this.getPlan(n.planId);if(!c)throw Error("Plan not found");await this.createSubscriptionChange({userId:e,fromPlanId:n.planId,toPlanId:n.planId,changeType:"reactivate",effectiveDate:new Date,status:"completed"});let d=await this.getUserSubscription(e);if(!d)throw Error("Failed to retrieve updated subscription");return{subscription:d,plan:c,nextBillingDate:d.currentPeriodEnd,canUpgrade:"enterprise"!==c.tier,canDowngrade:"free"!==c.tier}})}async recordPayment(e){return(await (0,t.addDoc)(this.paymentsRef,{...e,createdAt:t.Timestamp.now(),updatedAt:t.Timestamp.now()})).id}async getUserPayments(e,r=50){let a=(0,t.query)(this.paymentsRef,(0,t.where)("userId","==",e),(0,t.orderBy)("createdAt","desc"),(0,t.limit)(r)),i=await (0,t.getDocs)(a),n=[];return i.forEach(e=>{let t=e.data();n.push({id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date,updatedAt:t.updatedAt?.toDate()||new Date})}),n}async getAnalytics(){let e=await (0,t.getDocs)(this.subscriptionsRef),r=await this.getPlans(),a=0,i=0,n=0,s={free:0,pro:0,enterprise:0};e.forEach(e=>{let t=e.data();if("active"===t.status){a++;let e=r.find(e=>e.id===t.planId);e&&(s[e.tier]++,"free"!==e.tier&&(i+=e.price,n+=12*e.price))}});let o=e.size,c=o-a,d=a>0?i/a:0;return{totalActiveSubscriptions:a,totalMRR:i,totalARR:n,subscriptionsByPlan:s,churnRate:o>0?c/o*100:0,conversionRate:0,averageRevenuePerUser:d,newSubscriptionsThisMonth:0,canceledSubscriptionsThisMonth:0}}async createNotification(e){return(await (0,t.addDoc)(this.notificationsRef,{...e,createdAt:t.Timestamp.now()})).id}async getUserNotifications(e,r=!1){let a=(0,t.query)(this.notificationsRef,(0,t.where)("userId","==",e),(0,t.orderBy)("createdAt","desc"));r&&(a=(0,t.query)(a,(0,t.where)("read","==",!1)));let i=await (0,t.getDocs)(a),n=[];return i.forEach(e=>{let t=e.data();n.push({id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date})}),n}async updateUserProfileSubscription(e,a){let i=(0,t.doc)(r.db,"users",e),n=await this.getUserSubscription(e);if(n){let e={tier:a.tier,status:n.status,currentPeriodEnd:n.currentPeriodEnd,cancelAtPeriodEnd:n.cancelAtPeriodEnd,startDate:n.createdAt,planId:a.id,stripeSubscriptionId:n.stripeSubscriptionId};void 0!==n.trialEnd&&(e.trialEnd=n.trialEnd);let r={};Object.keys(e).forEach(t=>{void 0!==e[t]&&(r[t]=e[t])}),await (0,t.updateDoc)(i,{subscriptionTier:a.tier,subscription:r,features:a.limits,updatedAt:t.Timestamp.now()})}}async createSubscriptionChange(e){return(await (0,t.addDoc)(this.changesRef,{...e,createdAt:t.Timestamp.now(),updatedAt:t.Timestamp.now()})).id}getTierOrder(e){return({free:0,pro:1,enterprise:2})[e]}async checkPlanLimits(e,a){let i=await this.getUserSubscription(e);if(!i)return!1;let n=await this.getPlan(i.planId);if(!n)return!1;if("free"===n.tier){if("addCard"===a){let a=(0,t.collection)(r.db,"cards"),i=(0,t.query)(a,(0,t.where)("userId","==",e));return(await (0,t.getDocs)(i)).size<n.limits.maxCards}else if("addTransaction"===a){let a=(0,t.collection)(r.db,"transactions"),i=(0,t.query)(a,(0,t.where)("userId","==",e));return(await (0,t.getDocs)(i)).size<n.limits.maxTransactions}}return!0}async getUserLimits(e){let t=await this.getUserSubscription(e);if(t){let e=await this.getPlan(t.planId);return e?.limits||this.getDefaultLimits()}return this.getDefaultLimits()}getDefaultLimits(){return{maxCards:2,maxTransactions:10,analytics:!1,export:!1,prioritySupport:!1,apiAccess:!1,teamManagement:!1,customIntegrations:!1}}}let o=s.getInstance();e.s(["subscriptionService",0,o],69834)},65131,e=>{"use strict";var t=e.i(52621),r=e.i(82078),a=e.i(2188),i=e.i(69834),n=e.i(30945);let s=(0,r.createContext)(void 0),o=e=>({free:{maxCards:2,maxTransactions:10,analytics:!1,export:!1,prioritySupport:!1,apiAccess:!1,teamManagement:!1,customIntegrations:!1},pro:{maxCards:5,maxTransactions:-1,analytics:!0,export:!0,prioritySupport:!1,apiAccess:!1,teamManagement:!1,customIntegrations:!1},enterprise:{maxCards:-1,maxTransactions:-1,analytics:!0,export:!0,prioritySupport:!0,apiAccess:!0,teamManagement:!0,customIntegrations:!0}})[e];function c({children:c}){var d;let{user:l}=(0,a.useAuth)(),[u,p]=(0,r.useState)(null),[m,f]=(0,r.useState)(!0),[w,g]=(0,r.useState)(!1),h=u?.tier||"free",y=(d=u?.features||o(h),{...{free:{name:"Essential",primary:"#6b7280",secondary:"#4b5563",accent:"#9ca3af",background:"#1f2937",surface:"#374151",text:"#f3f4f6",textSecondary:"#d1d5db",border:"#6b7280",gradient:"linear-gradient(135deg, #4b5563 0%, #374151 100%)",features:[]},pro:{name:"Pro",primary:"#6366f1",secondary:"#4f46e5",accent:"#818cf8",background:"#1e1b4b",surface:"#312e81",text:"#e0e7ff",textSecondary:"#a5b4fc",border:"#4f46e5",gradient:"linear-gradient(135deg, #4f46e5 0%, #312e81 100%)",features:[]},enterprise:{name:"Enterprise",primary:"#8b5cf6",secondary:"#7c3aed",accent:"#a78bfa",background:"#1e1b4b",surface:"#312e81",text:"#ede9fe",textSecondary:"#c4b5fd",border:"#8b5cf6",gradient:"linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)",features:[]}}[h],maxCards:d.maxCards,maxTransactions:d.maxTransactions,analytics:d.analytics,export:d.export,prioritySupport:d.prioritySupport,features:[`Up to ${-1===d.maxCards?"unlimited":d.maxCards} cards`,-1===d.maxTransactions?"Unlimited transactions":`Up to ${d.maxTransactions} transactions/month`,...d.analytics?["Advanced analytics"]:[],...d.export?["Data export"]:[],...d.prioritySupport?["Priority support"]:[],...d.apiAccess?["API access"]:[],...d.teamManagement?["Team management"]:[],...d.customIntegrations?["Custom integrations"]:[]]}),b=(0,r.useCallback)(async()=>{if(!l){p(null),f(!1);return}try{f(!0);let e=null;try{e=await n.usersService.get(l.uid)}catch(e){console.warn("Failed to load user profile for subscription check",e)}let t=await i.subscriptionService.getUserSubscription(l.uid);if(t){let r=await i.subscriptionService.getPlan(t.planId);if(!r){console.error("âŒ [SubscriptionContext] No plan found for subscription:",t.planId);let e={tier:"free",status:"active",currentPeriodEnd:new Date(Date.now()+2592e6),cancelAtPeriodEnd:!1,startDate:new Date,planId:"free",features:o("free")};p(e);return}if(l?.email&&("spendflowapp@gmail.com".split(",")||[]).includes(l.email))console.log("ðŸ‘‘ [SubscriptionContext] Admin user detected, allowing enterprise access without Stripe validation");else{let e="active"===t.status&&(t.stripeSubscriptionId||"enterprise"===r.tier)&&!t.cancelAtPeriodEnd;if(console.log("ðŸ” [SubscriptionContext] Enterprise validation:",{planTier:r.tier,subscriptionStatus:t.status,hasStripeId:!!t.stripeSubscriptionId,cancelAtPeriodEnd:t.cancelAtPeriodEnd,hasValidEnterpriseAccess:e,userEmail:l?.email}),!e){console.warn("âš ï¸ [SubscriptionContext] Enterprise access detected but no valid subscription found. Downgrading to free tier.");let e={tier:"free",status:"active",currentPeriodEnd:new Date(Date.now()+2592e6),cancelAtPeriodEnd:!1,startDate:new Date,planId:"free",features:o("free")};p(e);return}}let a={tier:r.tier,status:t.status,currentPeriodEnd:t.currentPeriodEnd,cancelAtPeriodEnd:t.cancelAtPeriodEnd||!1,startDate:t.currentPeriodStart,trialEnd:t.trialEnd,planId:t.planId,stripeSubscriptionId:t.stripeSubscriptionId,features:r.limits};p(a),e?.subscriptionTier&&r.tier&&e.subscriptionTier!==r.tier&&console.warn(`âš ï¸ [SubscriptionContext] User profile subscriptionTier (${e.subscriptionTier}) doesn't match actual subscription (${r.tier}). This field should not override actual subscription logic.`)}else{let e={tier:"free",status:"active",currentPeriodEnd:new Date(Date.now()+2592e6),cancelAtPeriodEnd:!1,startDate:new Date,planId:"free",features:o("free")};p(e)}g(!1)}catch(e){if(console.error("âŒ [SubscriptionContext] Error loading subscription:",e),e instanceof Error&&("code"in e&&"resource-exhausted"===e.code||e.message?.includes("Quota exceeded")||e.message?.includes("resource-exhausted")||String(e).includes("resource-exhausted"))){console.warn("âš ï¸ [SubscriptionContext] Firebase quota exceeded detected, setting flag"),g(!0),p({tier:"free",status:"active",currentPeriodEnd:new Date(Date.now()+2592e6),cancelAtPeriodEnd:!1,startDate:new Date,planId:"free",features:o("free")});return}p({tier:"free",status:"active",currentPeriodEnd:new Date(Date.now()+2592e6),cancelAtPeriodEnd:!1,startDate:new Date,planId:"free",features:o("free")})}finally{f(!1)}},[l,p,f,g]);(0,r.useEffect)(()=>{b()},[b]);let A=(0,r.useCallback)(async t=>{if(l)try{f(!0);let{getFunctions:r,httpsCallable:a}=await e.A(34578),{getApp:i}=await e.A(9577),n=r(i()),s=a(n,"upgradeSubscription"),o=(await s({tier:t})).data;o.success&&("free"===t?(await b(),console.log("âœ… [SubscriptionContext] Successfully set to free tier")):o.checkoutUrl&&(console.log("âœ… [SubscriptionContext] Checkout session created, redirecting to Stripe..."),window.location.href=o.checkoutUrl))}catch(e){throw console.error("âŒ [SubscriptionContext] Error upgrading subscription:",e),e}finally{f(!1)}},[l,b,f]),D=(0,r.useCallback)(async()=>{if(l){if("free"===h)throw Error("Free tier subscriptions cannot be canceled");try{f(!0);let e=await i.subscriptionService.getUserSubscription(l.uid);if(!e)throw Error("No active subscription found");await i.subscriptionService.cancelSubscription(l.uid,e.id),await b()}catch(e){throw console.error("âŒ [SubscriptionContext] Error canceling subscription:",e),e}finally{f(!1)}}},[l,h,b,f]),S=(0,r.useCallback)(async()=>{if(l){if("free"===h)throw Error("Free tier subscriptions cannot be reactivated");try{f(!0);let e=await i.subscriptionService.getUserSubscription(l.uid);if(!e)throw Error("No active subscription found");await i.subscriptionService.reactivateSubscription(l.uid,e.id),await b()}catch(e){throw console.error("âŒ [SubscriptionContext] Error reactivating subscription:",e),e}finally{f(!1)}}},[l,h,b,f]),E=(0,r.useMemo)(()=>({tier:h,subscription:u,theme:y,isLoading:m,quotaExceeded:w,upgradeToTier:A,cancelSubscription:D,reactivateSubscription:S,canAccessFeature:e=>!!(u?.features||o(h))[e],refreshSubscription:b}),[h,u,y,m,w,A,D,S,b]);return(0,t.jsx)(s.Provider,{value:E,children:c})}function d(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useSubscription must be used within a SubscriptionProvider");return e}e.s(["SubscriptionProvider",()=>c,"useSubscription",()=>d])},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},38957,e=>{"use strict";var t=e.i(52621),r=e.i(82078);let a={USD:{code:"USD",symbol:"$",name:"US Dollar",locale:"en-US"},GBP:{code:"GBP",symbol:"Â£",name:"British Pound",locale:"en-GB"},EUR:{code:"EUR",symbol:"â‚¬",name:"Euro",locale:"de-DE"},JPY:{code:"JPY",symbol:"Â¥",name:"Japanese Yen",locale:"ja-JP"},CAD:{code:"CAD",symbol:"C$",name:"Canadian Dollar",locale:"en-CA"},AUD:{code:"AUD",symbol:"A$",name:"Australian Dollar",locale:"en-AU"},CHF:{code:"CHF",symbol:"CHF",name:"Swiss Franc",locale:"de-CH"},CNY:{code:"CNY",symbol:"Â¥",name:"Chinese Yuan",locale:"zh-CN"},INR:{code:"INR",symbol:"â‚¹",name:"Indian Rupee",locale:"en-IN"},NGN:{code:"NGN",symbol:"â‚¦",name:"Nigerian Naira",locale:"en-NG"}},i={US:"USD",GB:"GBP",UK:"GBP",DE:"EUR",FR:"EUR",IT:"EUR",ES:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CH:"CHF",CN:"CNY",IN:"INR",NG:"NGN"},n=(0,r.createContext)(void 0);function s({children:e}){let[s,o]=(0,r.useState)(a.USD),c=async()=>{try{let e=navigator.language,t=e.split("-")[1]?.toUpperCase();if(t&&i[t]){let e=i[t];o(a[e]);return}let r=await fetch("https://ipapi.co/json/"),n=(await r.json()).country_code;if(n&&i[n]){let e=i[n];o(a[e])}}catch(e){console.log("Could not detect currency, using USD as default")}};(0,r.useEffect)(()=>{let e=localStorage.getItem("preferredCurrency");e&&a[e]?o(a[e]):c()},[]);let d=Object.values(a);return(0,t.jsx)(n.Provider,{value:{currency:s,setCurrency:e=>{a[e]&&(o(a[e]),localStorage.setItem("preferredCurrency",e))},formatAmount:e=>new Intl.NumberFormat(s.locale,{style:"currency",currency:s.code,minimumFractionDigits:2,maximumFractionDigits:2}).format(e),availableCurrencies:d},children:e})}function o(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useCurrency must be used within a CurrencyProvider");return e}e.s(["CurrencyProvider",()=>s,"useCurrency",()=>o])}]);