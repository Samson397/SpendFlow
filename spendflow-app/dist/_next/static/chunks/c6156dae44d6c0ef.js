(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35408,e=>{"use strict";let t=(0,e.i(75254).default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);e.s(["TrendingDown",()=>t],35408)},77529,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],77529)},25652,e=>{"use strict";let t=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);e.s(["TrendingUp",()=>t],25652)},15287,e=>{"use strict";e.i(75271);var t=e.i(5158),a=e.i(41195);class r{static instance;categoriesRef=(0,t.collection)(a.db,"categories");constructor(){}static getInstance(){return r.instance||(r.instance=new r),r.instance}async getUserCategories(e){try{let a=(0,t.query)(this.categoriesRef,(0,t.where)("userId","==",e)),r=await (0,t.getDocs)(a),s=[];return r.forEach(e=>{let t=e.data();s.push({id:e.id,name:t.name,color:t.color,icon:t.icon,type:t.type})}),s}catch(e){return console.error("Error getting user categories:",e),[]}}async createCategory(e,a){try{return(await (0,t.addDoc)(this.categoriesRef,{...a,userId:e,createdAt:t.Timestamp.now(),updatedAt:t.Timestamp.now()})).id}catch(e){throw console.error("Error creating category:",e),Error("Failed to create category")}}async updateCategory(e,a){try{let r=(0,t.doc)(this.categoriesRef,e);await (0,t.updateDoc)(r,{...a,updatedAt:t.Timestamp.now()})}catch(e){throw console.error("Error updating category:",e),Error("Failed to update category")}}async deleteCategory(e){try{let a=(0,t.doc)(this.categoriesRef,e);await (0,t.deleteDoc)(a)}catch(e){throw console.error("Error deleting category:",e),Error("Failed to delete category")}}getDefaultCategories(e){return({income:[{name:"Salary",color:"#10b981",icon:"ðŸ’¼",type:"income"},{name:"Freelance",color:"#3b82f6",icon:"ðŸ’»",type:"income"},{name:"Investment",color:"#8b5cf6",icon:"ðŸ“ˆ",type:"income"},{name:"Gift",color:"#f59e0b",icon:"ðŸŽ",type:"income"},{name:"Other",color:"#6b7280",icon:"ðŸ’°",type:"income"}],expense:[{name:"Food",color:"#ef4444",icon:"ðŸ½ï¸",type:"expense"},{name:"Transport",color:"#f97316",icon:"ðŸš—",type:"expense"},{name:"Shopping",color:"#ec4899",icon:"ðŸ›ï¸",type:"expense"},{name:"Bills",color:"#6366f1",icon:"ðŸ“„",type:"expense"},{name:"Entertainment",color:"#8b5cf6",icon:"ðŸŽ¬",type:"expense"},{name:"Healthcare",color:"#06b6d4",icon:"ðŸ¥",type:"expense"},{name:"Other",color:"#6b7280",icon:"ðŸ“¦",type:"expense"}]})[e]||[]}async getAllCategories(e,t){let a=await this.getUserCategories(e),r=this.getDefaultCategories(t||"expense"),s=t?a.filter(e=>e.type===t):a,n=r.map(e=>({id:"",...e}));return s.forEach(e=>{let t=n.findIndex(t=>t.name===e.name&&t.type===e.type);t>=0?n[t]=e:n.push(e)}),n}}let s=r.getInstance();e.s(["categoryService",0,s])},85451,e=>{"use strict";function t(e){if(!e||!e.includes("/"))return{isExpired:!1,isExpiringSoon:!1,daysUntilExpiry:1/0};let[t,a]=e.split("/").map(e=>parseInt(e,10));if(isNaN(t)||isNaN(a)||t<1||t>12)return{isExpired:!1,isExpiringSoon:!1,daysUntilExpiry:1/0};let r=new Date(a<50?2e3+a:1900+a,t-1);r.setMonth(r.getMonth()+1,0),r.setHours(23,59,59,999);let s=new Date,n=Math.ceil((r.getTime()-s.getTime())/864e5),i=n<0;return{isExpired:i,isExpiringSoon:!i&&n<=30,daysUntilExpiry:n}}e.s(["getCardExpiryStatus",()=>t])},61659,e=>{"use strict";let t=(0,e.i(75254).default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);e.s(["CreditCard",()=>t],61659)},84099,e=>{"use strict";var t=e.i(52621),a=e.i(82078),r=e.i(20976),s=e.i(2188),n=e.i(31278);function i({children:e,requireAuth:i=!0}){let{user:l,loading:o}=(0,s.useAuth)(),c=(0,r.useRouter)();return((0,a.useEffect)(()=>{o||(i&&!l?c.push("/login"):!i&&l&&c.push("/dashboard"))},[l,o,i,c]),o)?(0,t.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(n.Loader2,{className:"h-12 w-12 text-amber-400 animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-slate-400 text-sm",children:"Loading..."})]})}):i&&!l||!i&&l?null:(0,t.jsx)(t.Fragment,{children:e})}e.s(["AuthGate",()=>i])},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},73755,e=>{"use strict";e.i(52621),e.i(82078);var t=e.i(69834),a=e.i(2188),r=e.i(65131);class s{static instance;constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}async checkFeatureAccess(e,a,r={}){try{if(await this.isUserAdmin(e))return{allowed:!0,reason:"Admin access - no limits applied",currentUsage:r.currentCount,limit:-1};let s=await t.subscriptionService.getUserLimits(e);if(!s[a])return{allowed:!1,reason:"This feature is not available on your current plan",upgradeRequired:!0};if(void 0!==r.currentCount&&"number"==typeof s[a]){let e=s[a];if(-1===e||r.currentCount<e)return{allowed:!0,currentUsage:r.currentCount,limit:-1===e?void 0:e};return{allowed:!1,reason:`You've reached your plan limit of ${e} ${a}`,upgradeRequired:!0,currentUsage:r.currentCount,limit:e}}return{allowed:!0}}catch(e){return console.error("Error checking feature access:",e),{allowed:!0,reason:"Unable to verify access, proceeding..."}}}async canAddCard(e){let t=await this.getCurrentCardCount(e);return this.checkFeatureAccess(e,"maxCards",{currentCount:t})}async canAddTransaction(e){let t=await this.getCurrentTransactionCount(e);return this.checkFeatureAccess(e,"maxTransactions",{currentCount:t})}async canExportData(e){return this.checkFeatureAccess(e,"export")}async canAccessAnalytics(e){return this.checkFeatureAccess(e,"analytics")}async canAccessAPI(e){return this.checkFeatureAccess(e,"apiAccess")}async hasPrioritySupport(e){return(await this.checkFeatureAccess(e,"prioritySupport")).allowed}async getUserLimits(e){return t.subscriptionService.getUserLimits(e)}async getUserPlanInfo(e){let a=await t.subscriptionService.getUserSubscription(e);if(!a)return null;let r=await t.subscriptionService.getPlan(a.planId);return{subscription:a,plan:r}}async isUserAdmin(t){try{let{usersService:a}=await e.A(76860),r=await a.get(t);if(r?.email&&("spendflowapp@gmail.com".split(",")||[]).includes(r.email))return!0;return r?.isAdmin===!0}catch(e){return console.error("Error checking admin status:",e),!1}}async getCurrentCardCount(t){try{let{cardsService:a}=await e.A(76860);return(await a.getByUserId(t)).length}catch(e){return console.error("Error getting card count:",e),0}}async getCurrentTransactionCount(t){try{let{transactionsService:a}=await e.A(76860);return(await a.getByUserId(t)).length}catch(e){return console.error("Error getting transaction count:",e),0}}}function n(){let{user:e}=(0,a.useAuth)(),{canAccessFeature:t}=(0,r.useSubscription)();return{checkFeatureAccess:async(t,a={})=>e?e.email&&("spendflowapp@gmail.com".split(",")||[]).includes(e.email)?{allowed:!0,reason:"Admin access - no limits applied",currentUsage:a.currentCount,limit:-1}:i.checkFeatureAccess(e.uid,t,a):{allowed:!1,reason:"User not authenticated"},canAddCard:async()=>e?e.email&&("spendflowapp@gmail.com".split(",")||[]).includes(e.email)?{allowed:!0,reason:"Admin access - no limits applied",limit:-1}:i.canAddCard(e.uid):{allowed:!1,reason:"User not authenticated"},canAddTransaction:async()=>e?e.email&&("spendflowapp@gmail.com".split(",")||[]).includes(e.email)?{allowed:!0,reason:"Admin access - no limits applied",limit:-1}:i.canAddTransaction(e.uid):{allowed:!1,reason:"User not authenticated"},canExportData:async()=>e?i.canExportData(e.uid):{allowed:!1,reason:"User not authenticated"},canAccessAnalytics:async()=>e?i.canAccessAnalytics(e.uid):{allowed:!1,reason:"User not authenticated"},canAccessAPI:async()=>e?i.canAccessAPI(e.uid):{allowed:!1,reason:"User not authenticated"},hasPrioritySupport:async()=>!!e&&i.hasPrioritySupport(e.uid),canAccessFeature:t}}let i=s.getInstance();e.s(["accessControlService",0,i,"useAccessControl",()=>n])},71589,e=>{"use strict";var t=e.i(52621),a=e.i(82078),r=e.i(37727),s=e.i(25652),n=e.i(35408),i=e.i(75254);let l=(0,i.default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var o=e.i(30945),c=e.i(15287),d=e.i(2188),u=e.i(38957);let p=(0,i.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var m=e.i(31278),h=e.i(77529);let g={async scanReceipt(e){try{let t=await this.fileToBase64(e),a=await this.extractTextFromImage(t),r=this.parseReceiptText(a);return r.category=this.detectCategory(a,r.merchant),r}catch(e){throw console.error("Error scanning receipt:",e),Error("Failed to scan receipt")}},fileToBase64:e=>new Promise((t,a)=>{let r=new FileReader;r.onload=()=>t(r.result),r.onerror=a,r.readAsDataURL(e)}),async extractTextFromImage(t){try{console.log("Loading Tesseract.js...");let a=await e.A(94307);console.log("Tesseract.js loaded successfully");let r=await a.recognize(t,"eng",{logger:e=>{"recognizing text"===e.status&&console.log(`OCR Progress: ${Math.round(100*e.progress)}%`)}});return console.log("OCR completed successfully"),r.data.text}catch(e){if(console.error("OCR Error:",e),e instanceof Error){if(e.message.includes("permission")||e.message.includes("denied"))throw console.warn("OCR permission error detected"),Error("Camera or file access permission denied. Please check your browser permissions.");if(e.message.includes("network")||e.message.includes("fetch"))throw console.warn("OCR network error detected"),Error("Network error while loading OCR. Please check your connection.")}return console.log("OCR failed, using fallback"),""}},parseReceiptText(e){let t={rawText:e};for(let a of[/\$?\s*(\d+\.\d{2})\s*(?:total|amount|sum|balance)/i,/(?:total|amount|sum|balance)\s*:?\s*\$?\s*(\d+\.\d{2})/i,/\$\s*(\d+\.\d{2})/g]){let r=e.match(a);if(r){let e=parseFloat(r[1]||r[0].replace(/[^0-9.]/g,""));if(!isNaN(e)&&e>0){t.amount=e;break}}}for(let a of[/(\d{1,2}[-/]\d{1,2}[-/]\d{2,4})/,/(\d{4}[-/]\d{1,2}[-/]\d{1,2})/,/(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\s+\d{1,2},?\s+\d{4}/i,/(\d{1,2})\s+(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\s+(\d{4})/i]){let r=e.match(a);if(r){let e=this.parseDate(r[0]);if(e){t.date=e;break}}}let a=e.split("\n").filter(e=>e.trim().length>0);return a.length>0&&(t.merchant=a[0].trim()),t},validateReceiptData(e){let t=[];return(!e.amount||e.amount<=0)&&t.push("Could not detect a valid amount"),(!e.merchant||e.merchant.length<2)&&t.push("Could not detect merchant name"),{valid:0===t.length,errors:t}},parseDate(e){try{let t=new Date(e);if(isNaN(t.getTime()))return null;let a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${a}-${r}-${s}`}catch(e){return null}},detectCategory(e,t){let a=e.toLowerCase(),r=(t||"").toLowerCase(),s=`${a} ${r}`;for(let[e,t]of Object.entries({Transport:["petrol","gas","fuel","shell","bp","esso","texaco","chevron","uber","lyft","taxi","parking"],Groceries:["grocery","supermarket","tesco","sainsbury","asda","waitrose","aldi","lidl","milk","bread","food mart","market"],Dining:["restaurant","cafe","coffee","starbucks","mcdonald","burger","pizza","kfc","subway","dining","bistro","grill"],Shopping:["store","shop","retail","amazon","ebay","clothing","fashion","nike","adidas","zara","h&m"],Entertainment:["cinema","movie","theater","netflix","spotify","game","entertainment","ticket"],Healthcare:["pharmacy","medical","doctor","hospital","clinic","health","boots","cvs","walgreens"],Utilities:["electric","water","gas bill","internet","phone bill","utility"],Other:[]}))for(let a of t)if(s.includes(a))return e;return"Other"}};function x({isOpen:e,onClose:s,onDataExtracted:n}){let[i,l]=(0,a.useState)(!1),[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[x,b]=(0,a.useState)(""),y=(0,a.useRef)(null),f=async e=>{if(console.log("handleFileSelect called with file:",e.name,e.type,"size:",e.size),e.size>0xa00000)return void b("File size too large. Please select a file smaller than 10MB.");if(!e.type.startsWith("image/"))return void b("Please select an image file (JPG, PNG, etc.)");try{l(!0),b(""),console.log("Starting scan...");let t=new FileReader;t.onload=e=>{console.log("Preview loaded successfully"),c(e.target?.result)},t.onerror=e=>{console.error("FileReader error:",e),b("Failed to read file. Please try again."),l(!1)},t.readAsDataURL(e);let a=g.scanReceipt(e),r=new Promise((e,t)=>setTimeout(()=>t(Error("Scan timeout")),3e4)),s=await Promise.race([a,r]);console.log("Scan complete, data:",s);let n={...s};n.date||(n.date=new Date().toISOString().split("T")[0]),u(n),console.log("Extracted data set:",n)}catch(t){console.error("Receipt scan error:",t);let e=t instanceof Error?t.message:"Unknown error";b(`Failed to scan receipt: ${e}. Please try again or enter manually.`)}finally{l(!1),console.log("Scanning finished")}},w=()=>{c(null),u(null),b(""),l(!1),s()};return e?(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-60",onClick:w,children:(0,t.jsxs)("div",{className:"bg-slate-950 border border-amber-700/30 rounded-lg shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden z-60",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("input",{ref:y,type:"file",accept:"image/*",className:"hidden",onChange:e=>{console.log("onChange triggered"),e.target.files?.[0]&&(console.log("File from onChange:",e.target.files[0].name),f(e.target.files[0]))},onInput:e=>{console.log("onInput triggered");let t=e.target;t.files?.[0]&&(console.log("File from onInput:",t.files[0].name),f(t.files[0]))}}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-serif text-slate-100 tracking-wide mb-1",children:"SCAN RECEIPT"}),(0,t.jsx)("p",{className:"text-slate-500 text-sm tracking-wider",children:"Take a photo or upload an image"})]}),(0,t.jsx)("button",{onClick:w,className:"text-slate-400 hover:text-slate-200 transition-colors",children:(0,t.jsx)(r.X,{className:"h-6 w-6"})})]}),(0,t.jsxs)("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[calc(90vh-200px)]",children:[!o&&!i&&(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("button",{onClick:()=>{y.current&&(y.current.value="",y.current.click())},className:"w-full p-12 border-2 border-dashed border-slate-700 hover:border-amber-600 rounded-lg transition-colors group",children:[(0,t.jsx)(p,{className:"h-20 w-20 mx-auto mb-4 text-slate-600 group-hover:text-amber-400 transition-colors"}),(0,t.jsx)("p",{className:"text-slate-300 font-serif tracking-wider text-lg",children:"Upload Receipt"}),(0,t.jsx)("p",{className:"text-slate-500 text-sm mt-2",children:"Take photo or choose from gallery"}),(0,t.jsx)("p",{className:"text-amber-400/60 text-xs mt-2",children:"ðŸ“± On mobile: Camera option available"})]})}),i&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-16",children:[(0,t.jsx)(m.Loader2,{className:"h-16 w-16 text-amber-400 animate-spin mb-4"}),(0,t.jsx)("p",{className:"text-slate-300 font-serif tracking-wider text-lg",children:"Scanning receipt..."}),(0,t.jsx)("p",{className:"text-amber-400 text-sm mt-2",children:"Reading text with OCR"}),(0,t.jsx)("p",{className:"text-slate-500 text-xs mt-2",children:"This usually takes 5-10 seconds"}),(0,t.jsx)("div",{className:"mt-4 w-64 bg-slate-800 rounded-full h-1",children:(0,t.jsx)("div",{className:"bg-amber-400 h-1 rounded-full animate-pulse",style:{width:"60%"}})})]}),o&&!i&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("img",{src:o,alt:"Receipt preview",className:"w-full rounded-lg border border-slate-700"})}),d&&(0,t.jsxs)("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(h.CheckCircle,{className:"h-5 w-5 text-green-400"}),(0,t.jsx)("h3",{className:"text-lg font-serif text-slate-100 tracking-wide",children:"Extracted Data"})]}),(0,t.jsx)("p",{className:"text-slate-500 text-xs",children:"Review and edit the automatically extracted information"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-500 text-xs uppercase tracking-wider mb-1",children:"Amount"}),(0,t.jsx)("input",{type:"number",step:"0.01",value:d.amount||"",onChange:e=>u({...d,amount:parseFloat(e.target.value)}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-500 text-xs uppercase tracking-wider mb-1",children:"Company Name"}),(0,t.jsx)("input",{type:"text",value:d.merchant||"",onChange:e=>u({...d,merchant:e.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-500 text-xs uppercase tracking-wider mb-1",children:"Category"}),(0,t.jsxs)("select",{value:d.category||"Other",onChange:e=>u({...d,category:e.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none",children:[(0,t.jsx)("option",{value:"Transport",children:"Transport"}),(0,t.jsx)("option",{value:"Groceries",children:"Groceries"}),(0,t.jsx)("option",{value:"Dining",children:"Dining"}),(0,t.jsx)("option",{value:"Shopping",children:"Shopping"}),(0,t.jsx)("option",{value:"Entertainment",children:"Entertainment"}),(0,t.jsx)("option",{value:"Healthcare",children:"Healthcare"}),(0,t.jsx)("option",{value:"Utilities",children:"Utilities"}),(0,t.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-500 text-xs uppercase tracking-wider mb-1",children:"Date"}),(0,t.jsx)("input",{type:"date",value:d.date||"",onChange:e=>u({...d,date:e.target.value}),className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none"})]})]}),(0,t.jsx)("p",{className:"text-slate-500 text-xs mt-4",children:"ðŸ’¡ Tip: OCR may not be 100% accurate - please verify the extracted data"})]}),x&&(0,t.jsx)("div",{className:"bg-red-900/20 border border-red-700/30 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-red-300 text-sm",children:x})})]})]}),o&&!i&&(0,t.jsxs)("div",{className:"flex gap-4 p-4 border-t border-slate-800",children:[(0,t.jsx)("button",{onClick:w,className:"flex-1 px-6 py-3 border border-slate-700 text-slate-300 hover:bg-slate-800 transition-colors font-serif tracking-wider uppercase",children:"Cancel"}),(0,t.jsx)("button",{onClick:()=>{d&&(n({amount:d.amount||0,merchant:d.merchant||"",date:d.date,category:d.category||"Other"}),w())},disabled:!d?.amount||!d?.merchant,className:"flex-1 px-6 py-3 border border-amber-600 text-amber-400 bg-amber-900/10 hover:bg-amber-600/20 transition-colors font-serif tracking-wider uppercase disabled:opacity-50 disabled:cursor-not-allowed",children:"Use This Data"})]})]})}):null}var b=e.i(85451);let y={income:["Salary","Freelance","Investment","Gift","Other"],expense:["Food","Transport","Shopping","Bills","Entertainment","Healthcare","Other"]};function f({isOpen:e,onClose:i,onSuccess:p,defaultType:m="expense"}){let{user:h}=(0,d.useAuth)(),{currency:g}=(0,u.useCurrency)(),[f,w]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),[N,k]=(0,a.useState)([]),[C,A]=(0,a.useState)({income:[],expense:[]}),[S,E]=(0,a.useState)({type:m,amount:"",category:"",description:"",cardId:"",date:new Date().toISOString().split("T")[0]});(0,a.useEffect)(()=>{e&&h&&(T(),F())},[e,h]);let T=async()=>{try{let e=(await o.cardsService.getByUserId(h.uid)).filter(e=>{if(!e.expiryDate)return!0;let{isExpired:t}=(0,b.getCardExpiryStatus)(e.expiryDate);return!t});k(e),e.length>0&&E(t=>({...t,cardId:e[0].id}))}catch(e){console.error("Error loading cards:",e)}},F=async()=>{if(h)try{let e=await c.categoryService.getAllCategories(h.uid),t=e.filter(e=>"income"===e.type).map(e=>e.name),a=e.filter(e=>"expense"===e.type).map(e=>e.name);A({income:t.length>0?t:y.income,expense:a.length>0?a:y.expense})}catch(e){console.error("Error loading categories:",e),A(y)}};if(!e)return null;let I=async e=>{if(e.preventDefault(),!h)return;let t=parseFloat(S.amount);if(!S.amount||isNaN(t)||t<=0)return void alert("Please enter a valid amount greater than 0");if(!S.description.trim())return void alert("Please enter a description or merchant name");if(!S.cardId)return void alert("Please select a card");try{w(!0),await o.transactionsService.create({userId:h.uid,type:S.type,amount:parseFloat(S.amount),category:S.category,description:S.description,cardId:S.cardId,date:new Date(S.date),isRecurring:!1});let e=N.find(e=>e.id===S.cardId);if(e){if("debit"===e.type){let t="income"===S.type?e.balance+parseFloat(S.amount):e.balance-parseFloat(S.amount);await o.cardsService.update(S.cardId,{balance:t})}else if("credit"===e.type){if("expense"===S.type){let t=e.balance-parseFloat(S.amount);await o.cardsService.update(S.cardId,{balance:t})}else if("income"===S.type){let t=e.balance+parseFloat(S.amount);await o.cardsService.update(S.cardId,{balance:t})}}}p(),i(),E({type:m,amount:"",category:"",description:"",cardId:N[0]?.id||"",date:new Date().toISOString().split("T")[0]})}catch(e){console.error("Error adding transaction:",e),alert("Failed to add transaction. Please try again.")}finally{w(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{isOpen:v,onClose:()=>j(!1),onDataExtracted:e=>{E(t=>({...t,amount:e.amount.toString(),description:e.merchant,category:e.category||"Other",date:e.date||t.date})),j(!1)}}),(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"bg-slate-950 border border-amber-700/30 rounded-lg w-full max-w-sm sm:max-w-md",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:["income"===S.type?(0,t.jsx)(s.TrendingUp,{className:"h-6 w-6 text-green-400"}):(0,t.jsx)(n.TrendingDown,{className:"h-6 w-6 text-amber-400"}),(0,t.jsxs)("h2",{className:"text-2xl font-serif text-slate-100 tracking-wide",children:["Add ","income"===S.type?"Income":"Expense"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["expense"===S.type&&(0,t.jsx)("button",{type:"button",onClick:()=>j(!0),className:"p-2 text-slate-400 hover:text-amber-400 transition-colors",title:"Scan Receipt",children:(0,t.jsx)(l,{className:"h-5 w-5"})}),(0,t.jsx)("button",{onClick:i,className:"text-slate-400 hover:text-slate-200 transition-colors",children:(0,t.jsx)(r.X,{className:"h-6 w-6"})})]})]}),(0,t.jsxs)("form",{onSubmit:I,className:"p-4 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-400 text-xs tracking-widest uppercase mb-2 font-serif",children:"Transaction Type"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>E({...S,type:"income",category:""}),className:`py-3 border transition-colors tracking-wider uppercase text-sm ${"income"===S.type?"border-green-600 text-green-400 bg-green-900/10":"border-slate-700 text-slate-400 hover:border-slate-600"}`,children:"Income"}),(0,t.jsx)("button",{type:"button",onClick:()=>E({...S,type:"expense",category:""}),className:`py-3 border transition-colors tracking-wider uppercase text-sm ${"expense"===S.type?"border-amber-600 text-amber-400 bg-amber-900/10":"border-slate-700 text-slate-400 hover:border-slate-600"}`,children:"Expense"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-400 text-xs tracking-widest uppercase mb-2 font-serif",children:"Amount"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:g.symbol}),(0,t.jsx)("input",{type:"number",step:"0.01",required:!0,value:S.amount,onChange:e=>E({...S,amount:e.target.value}),placeholder:"0.00",className:"w-full pl-8 pr-4 py-3 bg-slate-900/50 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none transition-colors font-serif"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-400 text-xs tracking-widest uppercase mb-2 font-serif",children:"Category"}),(0,t.jsxs)("select",{required:!0,value:S.category,onChange:e=>E({...S,category:e.target.value}),className:"w-full px-4 py-3 bg-slate-900/50 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none transition-colors font-serif",children:[(0,t.jsx)("option",{value:"",children:"Select category"}),C[S.type].map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-400 text-xs tracking-widest uppercase mb-2 font-serif",children:"Description"}),(0,t.jsx)("input",{type:"text",required:!0,value:S.description,onChange:e=>E({...S,description:e.target.value}),placeholder:"e.g., Grocery shopping",className:"w-full px-4 py-3 bg-slate-900/50 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none transition-colors font-serif"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-400 text-xs tracking-widest uppercase mb-2 font-serif",children:"Card/Account"}),(0,t.jsx)("select",{required:!0,value:S.cardId,onChange:e=>E({...S,cardId:e.target.value}),className:"w-full px-4 py-3 bg-slate-900/50 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none transition-colors font-serif",children:0===N.length?(0,t.jsx)("option",{value:"",children:"No valid cards available (expired cards are hidden)"}):N.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name||e.type," - ",e.type," (â€¢â€¢",e.lastFour||"****",")"]},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-slate-400 text-xs tracking-widest uppercase mb-2 font-serif",children:"Date"}),(0,t.jsx)("input",{type:"date",required:!0,value:S.date,onChange:e=>E({...S,date:e.target.value}),className:"w-full px-4 py-3 bg-slate-900/50 border border-slate-700 text-slate-100 rounded focus:border-amber-600 focus:outline-none transition-colors font-serif"})]}),(0,t.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,t.jsx)("button",{type:"button",onClick:i,className:"flex-1 px-6 py-3 border border-slate-700 text-slate-400 hover:border-slate-600 hover:text-slate-200 transition-colors tracking-wider uppercase text-sm",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:f||0===N.length,className:"flex-1 px-6 py-3 border border-amber-600 text-amber-400 hover:bg-amber-600/10 transition-colors tracking-wider uppercase text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:f?"Adding...":0===N.length?"No Valid Cards":"Add Transaction"})]})]})]})})]})}e.s(["AddTransactionModal",()=>f],71589)}]);